<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kh.cocoa.dao.FilesDAO">
<!-- *************************회사 소식***************************** -->
<!-- 파일 업로드 -->
	<insert id="uploadFiles">
		INSERT INTO FILES VALUES(FILES_SEQ.NEXTVAL, #{fdto.oriname}, #{fdto.savedname}, SYSDATE,#{noBoard_seq},0,0,0)
	</insert>
<!-- 게시글에 업로드된 파일 갯수 확인 -->
	<select id="isExistUploadFile" resultType="Integer">
  		SELECT COUNT(*) FROM FILES WHERE BOARD_SEQ=#{seq}
  	</select>
<!-- 첨부파일 다운로드 목록 -->
	<select id="downloadFileList" resultType="kh.cocoa.dto.FilesDTO">
		SELECT * FROM FILES WHERE BOARD_SEQ=#{noBoard_seq}
	</select>
<!-- 첨부파일 리스트 -->
	<select id="getFilesBySeq" resultType="kh.cocoa.dto.FilesDTO">
		SELECT * FROM FILES WHERE BOARD_SEQ=#{seq}
	</select>
<!-- 앨범 게시판 첨부파일 사진 불러오기 -->
	<select id="getImage" resultType="kh.cocoa.dto.FilesDTO">
      select * from files where BOARD_SEQ=#{seq}
   </select>
<!-- 파일 다운로드 -->
	<select id="downloadFilesBySeq" resultType="kh.cocoa.dto.FilesDTO">
		SELECT * FROM FILES WHERE BOARD_SEQ=#{noBoard_seq}
	</select>
<!-- 파일 삭제 -->
	<delete id="deleteNotificationBoardFiles">
		DELETE FROM FILES WHERE SEQ=#{seq}
	</delete>

	<select id="getFilesListByDocSeq" resultType="kh.cocoa.dto.FilesDTO">
		SELECT * FROM FILES WHERE DOCUMENT_SEQ=#{seq}
	</select>

	<!--용국 업로드-->
	<insert id="documentInsertFile">
		INSERT INTO FILES(SEQ,ORINAME,SAVEDNAME,UPLOADEDDATE,DOCUMENT_SEQ) VALUES(FILES_SEQ.NEXTVAL,#{oriName},#{savedName},sysdate,#{doc_seq})
	</insert>

	<!-- ****메세지 파일 업로드**** -->
	<insert id="uploadFilesMsg">
		<selectKey keyProperty="msg_seq" resultType="int" order="BEFORE">
		    SELECT MESSAGE_SEQ.NEXTVAL FROM USER_SEQUENCES WHERE SEQUENCE_NAME='MESSAGE_SEQ'
		</selectKey>
		INSERT INTO FILES (SEQ,ORINAME,SAVEDNAME,UPLOADEDDATE,MSG_SEQ) VALUES(FILES_SEQ.NEXTVAL, #{oriname}, #{savedname}, SYSDATE, #{msg_seq})
	</insert>
	<select id="getSavedName" resultType="String">
		SELECT SAVEDNAME FROM FILES WHERE MSG_SEQ=#{msg_seq} 
	</select>
	<!-- ****메세지 파일 업로드**** -->

	<!--용국 파일 삭제-->
	<delete id="deleteDocFile">
		delete from files where seq = #{seq}
	</delete>

	<select id="getFilesListByDocSeq2" resultType="kh.cocoa.dto.FilesDTO">
		SELECT * FROM FILES WHERE DOCUMENT_SEQ=#{seq}
	</select>

	<update id="updateFile">
		update files set document_seq=#{seq} where document_seq=#{b_seq}
	</update>

</mapper>